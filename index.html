<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Armar Expediente - Sistema Profesional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }
        @media (min-width: 768px) {
            .preview-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }
        }

        .preview-item {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .preview-img-container {
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f3f4f6;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            position: relative;
        }

        .preview-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        /* Botones de acci√≥n minimalistas */
        .btn-mini-rotate {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            border: none;
            z-index: 10;
        }

        .btn-mini-delete-img {
            position: absolute;
            top: 4px;
            left: 4px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            z-index: 10;
        }

        #custom-alert-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        input, select, textarea { font-size: 16px !important; }
        @media (min-width: 768px) {
            input, select, textarea { font-size: 14px !important; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-900 antialiased">

    <div id="custom-alert-overlay">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden">
            <div class="bg-slate-800 text-white px-4 py-3 font-bold text-xs uppercase tracking-widest">Sistema Expediente</div>
            <div class="p-5 text-slate-600 text-sm leading-relaxed" id="custom-alert-message"></div>
            <div class="p-3 bg-slate-50 text-right">
                <button onclick="cerrarAlerta()" class="bg-slate-800 text-white px-5 py-2 rounded-lg text-xs font-bold uppercase hover:bg-slate-700 transition-all">Entendido</button>
            </div>
        </div>
    </div>

    <div class="max-w-5xl mx-auto min-h-screen flex flex-col p-3 md:p-6">
        <header class="bg-white rounded-2xl shadow-sm p-4 md:p-6 mb-6 border border-slate-200">
            <h1 class="text-xl md:text-2xl font-black text-center text-slate-800 uppercase tracking-tighter">Armar Expediente</h1>
        </header>

        <main class="flex-grow space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                    <label class="block text-[10px] font-black uppercase text-slate-400 mb-2">Comit√© de Cr√©dito</label>
                    <div class="flex gap-2">
                        <input type="file" accept="image/*" onchange="procesarInput(this, 'fijo-0')" class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200">
                        <button onclick="document.getElementById('cam-f-0').click()" class="bg-slate-800 text-white p-2 rounded-xl text-lg">üì∑</button>
                        <input type="file" accept="image/*" capture="environment" class="hidden" id="cam-f-0" onchange="procesarInput(this, 'fijo-0')">
                    </div>
                    <div class="preview-grid" id="preview-fijo-0"></div>
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                    <label class="block text-[10px] font-black uppercase text-slate-400 mb-2">Solicitud de Cr√©dito (M√°x 4)</label>
                    <div class="flex gap-2">
                        <input type="file" accept="image/*" multiple onchange="procesarMultipleSolicitud(this)" class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200">
                        <button onclick="document.getElementById('cam-sol-m').click()" class="bg-slate-800 text-white p-2 rounded-xl text-lg">üì∑</button>
                        <input type="file" accept="image/*" capture="environment" class="hidden" id="cam-sol-m" onchange="procesarMultipleSolicitud(this)">
                    </div>
                    <div class="preview-grid" id="preview-solicitud-grid"></div>
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                    <label class="block text-[10px] font-black uppercase text-slate-400 mb-2">Croquis del Grupo</label>
                    <div class="flex gap-2">
                        <input type="file" accept="image/*" onchange="procesarInput(this, 'fijo-3')" class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200">
                        <button onclick="document.getElementById('cam-f-3').click()" class="bg-slate-800 text-white p-2 rounded-xl text-lg">üì∑</button>
                        <input type="file" accept="image/*" capture="environment" class="hidden" id="cam-f-3" onchange="procesarInput(this, 'fijo-3')">
                    </div>
                    <div class="preview-grid" id="preview-fijo-3"></div>
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                    <label class="block text-[10px] font-black uppercase text-slate-400 mb-2">Acta de Compromiso</label>
                    <div class="flex gap-2">
                        <input type="file" accept="image/*" onchange="procesarInput(this, 'fijo-2')" class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200">
                        <button onclick="document.getElementById('cam-f-2').click()" class="bg-slate-800 text-white p-2 rounded-xl text-lg">üì∑</button>
                        <input type="file" accept="image/*" capture="environment" class="hidden" id="cam-f-2" onchange="procesarInput(this, 'fijo-2')">
                    </div>
                    <div class="preview-grid" id="preview-fijo-2"></div>
                </div>
            </div>

            <div class="bg-blue-600 p-5 rounded-2xl shadow-lg">
                <label class="block text-[10px] font-black uppercase text-blue-200 mb-3 tracking-widest text-center">Registrar nuevo integrante</label>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="nombre-cliente-temporal" placeholder="Nombres y Apellidos" class="flex-grow p-3 rounded-xl border-none outline-none text-sm font-bold shadow-inner">
                    <button onclick="confirmarNuevoCliente()" class="bg-white text-blue-600 px-6 py-3 rounded-xl font-black text-sm uppercase hover:bg-blue-50 transition-colors">Confirmar</button>
                </div>
            </div>

            <div id="clientes-container" class="space-y-6 pt-4">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] border-b pb-2">Lista de Expedientes Individuales</h2>
            </div>
        </main>

        <footer class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-3 pb-6">
            <button onclick="generarPDF()" class="bg-emerald-500 text-white py-4 rounded-2xl font-black uppercase text-sm shadow-lg shadow-emerald-200 hover:bg-emerald-600 transition-all active:scale-95">Descargar PDF Final</button>
            <button onclick="borrarTodo()" class="bg-slate-200 text-slate-500 py-4 rounded-2xl font-bold uppercase text-xs hover:bg-red-100 hover:text-red-600 transition-all">Limpiar todo el sistema</button>
        </footer>
    </div>

    <script>
        function mostrarAlerta(m) {
            document.getElementById('custom-alert-message').innerText = m;
            document.getElementById('custom-alert-overlay').style.display = 'flex';
        }
        function cerrarAlerta() { document.getElementById('custom-alert-overlay').style.display = 'none'; }

        let clienteCount = 0;
        let db;
        const listaDocs = ["DNI frontal", "DNI posterior", "Selfin de casa", "Selfin negocio", "foto negocio", "negocio 1", "negocio 2", "recibo de luz o DJ", "Sentinel"];

        const request = indexedDB.open("ExpedienteDB", 1);
        request.onupgradeneeded = (e) => { db = e.target.result; db.createObjectStore("datos", { keyPath: "id" }); };
        request.onsuccess = (e) => { db = e.target.result; restaurarDatos(); };

        async function guardarDato(id, valor) { const tx = db.transaction("datos", "readwrite"); tx.objectStore("datos").put({ id, valor }); }
        async function obtenerDato(id) { return new Promise(r => { const tx = db.transaction("datos", "readonly"); const req = tx.objectStore("datos").get(id); req.onsuccess = () => r(req.result ? req.result.valor : null); }); }
        async function eliminarDato(id) { const tx = db.transaction("datos", "readwrite"); tx.objectStore("datos").delete(id); }

        function confirmarNuevoCliente() {
            const n = document.getElementById('nombre-cliente-temporal').value.trim();
            if (!n) { mostrarAlerta("SISTEMA EXPEDIENTE: Es necesario agregar un nombre del cliente para continuar."); return; }
            agregarCliente(n);
            document.getElementById('nombre-cliente-temporal').value = "";
        }

        function agregarCliente(nom = "", idPersist = null) {
            if (!idPersist) clienteCount++; else clienteCount = Math.max(clienteCount, idPersist);
            const idActual = idPersist || clienteCount;
            const container = document.getElementById('clientes-container');
            const div = document.createElement('div');
            div.className = "bg-white border border-slate-200 rounded-3xl shadow-sm overflow-hidden";
            div.id = `cliente-wrapper-${idActual}`;
            
            let ops = listaDocs.map(d => `<option value="${d}">${d}</option>`).join('');
            div.innerHTML = `
                <div class="p-4 bg-slate-50 flex flex-wrap items-center justify-between gap-3 border-b border-slate-100">
                    <div class="flex items-center gap-2 flex-grow">
                        <input type="text" id="nombre-input-${idActual}" value="${nom}" readonly class="bg-transparent font-black text-slate-700 outline-none border-none w-full sm:w-auto min-w-[150px]">
                        <button onclick="habilitarEdicion(${idActual}, event)" class="text-blue-500 font-bold text-xs p-2 uppercase">Editar</button>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleAcordeon('cliente-${idActual}')" class="bg-white border border-slate-200 px-4 py-2 rounded-xl text-[10px] font-bold uppercase">Ver fotos</button>
                        <button onclick="eliminarCliente(${idActual})" class="bg-red-50 text-red-500 p-2 rounded-xl">üóëÔ∏è</button>
                    </div>
                </div>
                <div id="cliente-${idActual}" class="p-4 hidden space-y-4">
                    <select onchange="validarRequisitosYFlujo(${idActual}, this)" class="w-full p-3 rounded-xl bg-slate-100 text-xs font-bold uppercase outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">+ Agregar Documento</option>
                        ${ops}
                    </select>
                    <div id="documentos-lista-${idActual}" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                </div>
            `;
            container.appendChild(div);
            if(!idPersist) { guardarDato(`cliente-${idActual}-nombre`, nom); guardarDato("clienteCount", clienteCount); }
        }

        function habilitarEdicion(id, ev) {
            const inp = document.getElementById(`nombre-input-${id}`);
            const btn = ev.currentTarget;
            if (inp.readOnly) {
                inp.readOnly = false; inp.focus(); inp.style.borderBottom = "2px solid #3b82f6"; btn.innerText = "GUARDAR";
            } else {
                inp.readOnly = true; inp.style.borderBottom = "none"; btn.innerText = "EDITAR";
                guardarDato(`cliente-${id}-nombre`, inp.value);
            }
        }

        async function procesarInput(input, sId) {
            if (input.files && input.files[0]) {
                const b64 = await readFileAsDataURL(input.files[0]);
                await guardarDato(sId, b64); await guardarDato(sId + "-rot", 0);
                renderPreview(sId, b64, 0);
            }
        }

        async function procesarMultipleSolicitud(input) {
            if (input.files) {
                const arr = Array.from(input.files);
                let cur = 0; for(let i=0; i<4; i++) if(await obtenerDato(`fijo-1-${i}`)) cur++;
                for(let f of arr.slice(0, 4 - cur)) {
                    for(let i=0; i<4; i++) {
                        if(!(await obtenerDato(`fijo-1-${i}`))) {
                            const b64 = await readFileAsDataURL(f);
                            await guardarDato(`fijo-1-${i}`, b64); await guardarDato(`fijo-1-${i}-rot`, 0);
                            renderPreview(`fijo-1-${i}`, b64, 0); break;
                        }
                    }
                }
                input.value = "";
            }
        }

        function renderPreview(sId, b64, rot) {
            let c;
            if (sId.startsWith('fijo-1-')) {
                let sc = document.getElementById(`preview-item-${sId}`);
                if(!sc) { sc = document.createElement('div'); sc.id = `preview-item-${sId}`; sc.className = "preview-item"; document.getElementById('preview-solicitud-grid').appendChild(sc); }
                c = sc;
            } else { c = document.getElementById(`preview-${sId}`); if(!c) return; }
            c.innerHTML = `
                <div class="preview-img-container">
                    <button class="btn-mini-delete-img" onclick="quitarFoto('${sId}')">X</button>
                    <button class="btn-mini-rotate" onclick="rotarImagen('${sId}')">‚Ü∫</button>
                    <img src="${b64}" class="preview-img" style="transform: rotate(${rot}deg)">
                </div>
            `;
        }

        async function rotarImagen(sId) {
            let r = ( (await obtenerDato(sId + "-rot") || 0) + 90) % 360;
            await guardarDato(sId + "-rot", r); renderPreview(sId, await obtenerDato(sId), r);
        }

        async function quitarFoto(sId) {
            if(confirm("¬øEliminar fotograf√≠a?")) {
                await eliminarDato(sId); await eliminarDato(sId + "-rot");
                if (sId.startsWith('fijo-1-')) document.getElementById(`preview-item-${sId}`)?.remove();
                else document.getElementById(`preview-${sId}`).innerHTML = "";
            }
        }

        async function validarRequisitosYFlujo(cliId, sel) {
            const tipo = sel.value; if(!tipo) return;
            const ord = await obtenerDato(`cli-${cliId}-orden`) || [];
            if(ord.some(i => i.tipo === tipo)) { mostrarAlerta("SISTEMA EXPEDIENTE: Esta secci√≥n ya ha sido agregada."); sel.value = ""; return; }

            if(tipo === "negocio 1" || tipo === "negocio 2") {
                const reqs = ["DNI frontal", "DNI posterior", "Selfin de casa", "Selfin negocio", "foto negocio"];
                let falt = reqs.filter(r => !ord.some(i => i.tipo === r));
                if(falt.length > 0) { mostrarAlerta(`SISTEMA EXPEDIENTE: No se permite agregar esta secci√≥n sin haber agregado: ${falt.join(", ")}`); sel.value = ""; return; }
            } else {
                const idx = listaDocs.indexOf(tipo);
                for(let i=0; i<idx; i++) {
                    if(listaDocs[i].includes("negocio")) continue;
                    if(!ord.some(it => it.tipo === listaDocs[i])) { mostrarAlerta(`SISTEMA EXPEDIENTE: Debe agregar primero "${listaDocs[i]}" seg√∫n el flujo obligatorio.`); sel.value = ""; return; }
                }
            }
            crearCampoDoc(cliId, tipo); sel.value = "";
        }

        async function crearCampoDoc(cliId, t, idUG = null) {
            const c = document.getElementById(`documentos-lista-${cliId}`);
            const idU = idUG || Date.now() + Math.random().toString(36).substr(2, 4);
            const div = document.createElement('div');
            div.className = "bg-slate-50 p-3 rounded-2xl border border-slate-100";
            div.id = `doc-wrapper-${idU}`; div.setAttribute('data-tipo', t);
            const sId = `img-${cliId}-${idU}-0`;
            div.innerHTML = `
                <div class="flex justify-between items-center mb-2"><span class="text-[9px] font-black uppercase text-slate-400 tracking-wider">${t}</span><button onclick="eliminarSeccionDoc('${cliId}', '${idU}')" class="text-red-400 text-[9px] font-bold uppercase">Quitar</button></div>
                <div class="flex gap-2 mb-2">
                    <input type="file" onchange="procesarInput(this, '${sId}')" class="text-[10px] w-full">
                    <button onclick="document.getElementById('cam-${sId}').click()" class="bg-white border p-1 rounded-lg">üì∑</button>
                    <input type="file" capture="environment" class="hidden" id="cam-${sId}" onchange="procesarInput(this, '${sId}')">
                </div>
                <div class="preview-grid" id="preview-${sId}"></div>
            `;
            const iR = listaDocs.indexOf(t);
            const hs = Array.from(c.children); let ins = false;
            for (let h of hs) { if (listaDocs.indexOf(h.getAttribute('data-tipo')) > iR) { c.insertBefore(div, h); ins = true; break; } }
            if (!ins) c.appendChild(div);
            if(!idUG) { let o = await obtenerDato(`cli-${cliId}-orden`) || []; o.push({id: idU, tipo: t}); await guardarDato(`cli-${cliId}-orden`, o); }
        }

        async function eliminarSeccionDoc(cliId, idU) {
            if(confirm("¬øEliminar esta secci√≥n?")) {
                document.getElementById(`doc-wrapper-${idU}`).remove();
                let o = (await obtenerDato(`cli-${cliId}-orden`) || []).filter(i => i.id !== idU);
                await guardarDato(`cli-${cliId}-orden`, o);
                await eliminarDato(`img-${cliId}-${idU}-0`); await eliminarDato(`img-${cliId}-${idU}-0-rot`);
            }
        }

        async function restaurarDatos() {
            for(let i of [0, 3, 2]) { const f = await obtenerDato(`fijo-${i}`); if(f) renderPreview(`fijo-${i}`, f, await obtenerDato(`fijo-${i}-rot`) || 0); }
            for(let i=0; i<4; i++) { const f = await obtenerDato(`fijo-1-${i}`); if(f) renderPreview(`fijo-1-${i}`, f, await obtenerDato(`fijo-1-${i}-rot`) || 0); }
            const sc = await obtenerDato("clienteCount") || 0;
            for(let i=1; i<=sc; i++) {
                const n = await obtenerDato(`cliente-${i}-nombre`);
                if(n !== null) {
                    agregarCliente(n, i);
                    const o = await obtenerDato(`cli-${i}-orden`) || [];
                    for(let it of o.sort((a,b) => listaDocs.indexOf(a.tipo) - listaDocs.indexOf(b.tipo))) {
                        await crearCampoDoc(i, it.tipo, it.id);
                        const sId = `img-${i}-${it.id}-0`; const f = await obtenerDato(sId);
                        if(f) renderPreview(sId, f, await obtenerDato(sId + "-rot") || 0);
                    }
                }
            }
        }

        async function prepararImagenPDF(sId) {
            const d = await obtenerDato(sId); if (!d) return null;
            const r = await obtenerDato(sId + "-rot") || 0;
            const img = new Image(); img.src = d; await img.decode();
            const canv = document.createElement('canvas'); const ctx = canv.getContext('2d');
            if(r === 90 || r === 270) { canv.width = img.height; canv.height = img.width; } else { canv.width = img.width; canv.height = img.height; }
            ctx.translate(canv.width/2, canv.height/2); ctx.rotate(r * Math.PI / 180); ctx.drawImage(img, -img.width/2, -img.height/2);
            return { url: canv.toDataURL('image/jpeg', 0.8), w: canv.width, h: canv.height };
        }

        async function generarPDF() {
            const { jsPDF } = window.jspdf; const doc = new jsPDF('p', 'mm', 'a4');
            const pw = doc.internal.pageSize.getWidth(); const ph = doc.internal.pageSize.getHeight();
            let first = true;
            const addImg = (obj, x, y, mw, mh) => {
                const r = obj.w / obj.h; let w = mw, h = w / r; if (h > mh) { h = mh; w = h * r; }
                doc.addImage(obj.url, 'JPEG', x + (mw - w) / 2, y + (mh - h) / 2, w, h);
            };
            const addNom = (n) => { doc.setFontSize(10); doc.setTextColor(100); doc.text(`CLIENTE: ${n.toUpperCase()}`, 10, 8); };

            const cmt = await prepararImagenPDF('fijo-0'); if(cmt) { doc.addImage(cmt.url, 'JPEG', 10, 10, pw-20, ph-20); first = false; }
            for(let i=0; i<4; i++) {
                const f = await prepararImagenPDF(`fijo-1-${i}`);
                if(f) { if(!first) doc.addPage(); addImg(f, 10, 10, pw-20, ph-20); first = false; }
            }
            for(let k of ['fijo-3', 'fijo-2']) { const f = await prepararImagenPDF(k); if(f) { doc.addPage(); addImg(f, 10, 10, pw-20, ph-20); } }

            const sc = await obtenerDato("clienteCount") || 0;
            for (let i = 1; i <= sc; i++) {
                const n = await obtenerDato(`cliente-${i}-nombre`); if (n === null) continue;
                const o = await obtenerDato(`cli-${i}-orden`) || [];
                const dcs = [];
                for (let it of o.sort((a,b) => listaDocs.indexOf(a.tipo) - listaDocs.indexOf(b.tipo))) {
                    const f = await prepararImagenPDF(`img-${i}-${it.id}-0`); if (f) dcs.push({ tipo: it.tipo, foto: f });
                }
                const dnis = dcs.filter(d => d.tipo.startsWith("DNI")).map(d => d.foto);
                if (dnis.length > 0) { doc.addPage(); addNom(n); if (dnis[0]) addImg(dnis[0], 10, 10, pw - 20, (ph / 2) - 15); if (dnis[1]) addImg(dnis[1], 10, ph / 2, pw - 20, (ph / 2) - 15); }
                const grd = dcs.filter(d => ["Selfin de casa", "Selfin negocio", "foto negocio", "negocio 1", "negocio 2"].includes(d.tipo)).map(d => d.foto);
                if (grd.length > 0) {
                    doc.addPage(); addNom(n); let x = 10, y = 15, bw = (pw-30)/2, bh = (ph-40)/3;
                    grd.forEach((im, ix) => { if(ix > 0 && ix % 6 === 0) { doc.addPage(); addNom(n); x=10; y=15; } addImg(im, x, y, bw, bh); x += bw + 10; if(x + bw > pw) { x = 10; y += bh + 10; } });
                }
                const fin = dcs.filter(d => ["recibo de luz o DJ", "Sentinel"].includes(d.tipo)).map(d => d.foto);
                if (fin.length > 0) { doc.addPage(); addNom(n); if (fin[0]) addImg(fin[0], 10, 10, pw - 20, (ph / 2) - 15); if (fin[1]) addImg(fin[1], 10, ph / 2, pw - 20, (ph / 2) - 15); }
            }
            doc.save(`Expediente_${new Date().getTime()}.pdf`);
        }

        async function eliminarCliente(id) {
            if(confirm("¬øEliminar este expediente individual?")) {
                document.getElementById(`cliente-wrapper-${id}`).remove();
                const o = await obtenerDato(`cli-${id}-orden`) || [];
                for(let it of o) { await eliminarDato(`img-${id}-${it.id}-0`); await eliminarDato(`img-${id}-${it.id}-0-rot`); }
                await eliminarDato(`cli-${id}-orden`); await eliminarDato(`cliente-${id}-nombre`);
            }
        }

        function toggleAcordeon(id) { document.getElementById(id).classList.toggle('hidden'); }
        function borrarTodo() { if(confirm("¬øBorrar todos los datos?")) { indexedDB.deleteDatabase("ExpedienteDB"); location.reload(); } }
        function readFileAsDataURL(f) { return new Promise(r => { const rd = new FileReader(); rd.onload = () => r(rd.result); rd.readAsDataURL(f); }); }
    </script>
</body>
</html>
